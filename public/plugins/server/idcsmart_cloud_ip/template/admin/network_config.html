<link rel="stylesheet" href="/plugins/server/idcsmart_cloud_ip/template/admin/css/network_config.css">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<div class="network-config" v-cloak>
  <div class="t-card">
    <div class="box">
      <div class="disk-box">
        <p class="com-tit"><span>{{ lang.bw_list }}</span></p>
        <!-- 网络列表 -->
        <!-- <div class="com-create">
          <p @click="addDisk">{{lang.create}}</p>
        </div> -->
        <div class="com-top">
          <span>{{lang.bw_list}}</span>
          <i></i>
        </div>
        <t-table row-key="id" :data="networkList" size="medium" :columns="networkColumns" :hover="hover"
          :loading="diskLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
          :hide-sort-tips="true" bordered>
          <template slot="sortIcon">
            <t-icon name="caret-down-small"></t-icon>
          </template>
          <template #area="{row}">
            <span v-for="(i,ind) in row.data_center">
              {{i.country+i.city+i.area}}
              <span v-if="row.data_center.length > 1 && ind !== row.data_center.length -1">、</span>
            </span>
          </template>
          <template #ip_enable="{row}">
            <div class="com-enable-switch" :class="{active: row.ip_enable}">
              <span class="line"></span>
              <span class="circle"></span>
            </div>
          </template>
          <template #bw_enable="{row}">
            <div class="com-enable-switch" :class="{active: row.bw_enable}">
              <span class="line"></span>
              <span class="circle"></span>
            </div>
          </template>
          <template #op="{row}">
            <div class="com-opt">
              <t-icon name="edit-1" @click="editDisk(row)"></t-icon>
              <!-- <t-icon name="delete" @click="comDel('bw',row)"></t-icon> -->
            </div>
          </template>
        </t-table>
      </div>
      <!-- 周期 -->
      <div class="duration-box">
        <p class="com-tit"><span>{{ lang.cycle }}</span></p>
        <t-table row-key="id" :data="durationList" size="medium" :columns="durationColumns" :hover="hover"
          :loading="durationLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
          :hide-sort-tips="true" bordered>
          <template slot="sortIcon">
            <t-icon name="caret-down-small"></t-icon>
          </template>
          <template #ip_ratio="{row}">
            <t-input v-model="row.ip_ratio" v-if="row.status" autofocus></t-input>
            <span v-else>{{row.ip_ratio}}</span>
          </template>
          <template #bw_ratio="{row}">
            <t-input v-model="row.bw_ratio" v-if="row.status" autofocus></t-input>
            <span v-else>{{row.bw_ratio}}</span>
          </template>
          <template #op="{row}">
            <div class="com-opt">
              <t-icon name="edit-1" @click="editDuration(row)" v-if="!row.status"></t-icon>
              <t-icon name="save" @click="saveDuration(row)" v-else></t-icon>
            </div>
          </template>
        </t-table>
      </div>
    </div>
  </div>
  <!-- 新增/修改磁盘弹窗 -->
  <t-dialog :header="dataTitle" :visible.sync="networkModel" :footer="false" width="740" @close="closeDisk">
    <t-form :data="networkForm" ref="networkForm" @submit="submitNetwork" :rules="networkRules" class="network-form"
      v-if="networkModel" :label-width="130">
      <t-form-item :label="lang.attach+'IP'">
        <div class="com-enable-switch mod" :class="{active: networkForm.ip_enable}"
          @click="changeIp(networkForm.ip_enable)">
          <span class="line"></span>
          <span class="circle"></span>
        </div>
      </t-form-item>
      <t-form-item :label="lang.unit_price" name="ip_price" :rules="[
      { required: networkForm.ip_enable, message: lang.input + lang.size_min, type: 'error' },
      {
        pattern: /^\d+(\.\d{0,2})?$/, message: lang.verify5, type: 'warning'
      }]">
        <t-input v-model="networkForm.ip_price" :placeholder="lang.input+lang.unit_price"></t-input>
      </t-form-item>
      <t-form-item name="ip_max" :label="lang.single_max" :rules=" [
      { required:  networkForm.ip_enable, message: lang.input + lang.single_max, type: 'error', trigger: 'blur' },
      {
        pattern: /^([1-9][0-9]*)$/, message: lang.input + lang.verify16, type: 'warning'
      }]
      ">
        <t-input v-model="networkForm.ip_max" :placeholder="lang.input + lang.single_max"></t-input>
      </t-form-item>
      <t-form-item :label="lang.alone_bw">
        <div class="com-enable-switch mod" :class="{active: networkForm.bw_enable}"
          @click="changeBw(networkForm.bw_enable)">
          <span class="line"></span>
          <span class="circle"></span>
        </div>
      </t-form-item>

      <t-form-item :label="lang.min_precision" name="bw_precision" :rules="[
      { required: networkForm.bw_enable, message: lang.input + lang.min_precision, type: 'error' },
      {
        pattern: /^([1-9][0-9]*)$/, message: lang.input + lang.verify16, type: 'warning'
      }]">
        <t-input v-model="networkForm.bw_precision" :placeholder="lang.input+lang.min_precision"></t-input>
      </t-form-item>
      <!-- 配置价格 -->
      <div class="price-box">
        <t-form-item :label="lang.price" v-if="networkForm.bw_price.length > 0" class="price-label"
          :class="{req: networkForm.bw_enable}">
          <template v-for="(item,index) in networkForm.bw_price">
            <div class="price-item">
              <span style="margin-right: 10px;">{{lang.bw_form}}</span>
              <t-form-item :name="`bw_price[${index}].min`" :required-mark="false">
                <t-input v-model="calMin(index,networkForm)" :placeholder="lang.min_num" @change="changeNum" disabled>
                </t-input>
              </t-form-item>
              <span class="to">{{lang.bw_to}}</span>
              <t-form-item :name="`bw_price[${index}].max`" :required-mark="false" :rules="[
              { validator: checkSize1(item.max,index,networkForm)}, 
              { required: networkForm.bw_enable, message: lang.input + lang.max_num, type: 'error' },
              {
                pattern: /^\d+$/, message: lang.input + lang.verify16, type: 'warning'
              }
              ]">
                <t-input v-model="item.max" :placeholder="lang.max_num" @change="changeNum1($event,index)">
                </t-input>
              </t-form-item>
              <div class="price">
                <span class="unit-price">{{lang.unit_price}}</span>
                <t-form-item :name="`bw_price[${index}].price`" :required-mark="false" :rules="[
                { required: networkForm.bw_enable, message: lang.input + lang.unit_price, type: 'error' },
                {
                  pattern: /^\d+(\.\d{0,2})?$/, message: lang.verify5, type: 'warning'
                }
                ]">
                  <t-input v-model="item.price" :placeholder="lang.unit_price">
                  </t-input>
                </t-form-item>
              </div>
              <div class="com-icon" @click="deletePrice(index)" v-if="networkForm.bw_price.length !== 1">
                <t-icon name="remove"></t-icon>
              </div>
              <div class="com-icon" @click="addPrice(index)" v-if="index === networkForm.bw_price.length - 1">
                <t-icon name="add"></t-icon>
              </div>
            </div>
          </template>
        </t-form-item>
      </div>
      <div class="com-f-btn">
        <t-button theme="primary" type="submit">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="closeDisk">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 删除提示框 -->
  <t-dialog theme="warning" :header="lang.sureDelete" :close-btn="false" :visible.sync="delVisible">
    <template slot="footer">
      <t-button theme="primary" @click="sureDelete">{{lang.sure}}</t-button>
      <t-button theme="default" @click="delVisible=false">{{lang.cancel}}</t-button>
    </template>
  </t-dialog>
</div>
<script src="/plugins/server/idcsmart_cloud_ip/template/admin/api/network_config.js"></script>


<script src="/plugins/server/idcsmart_cloud_ip/template/admin/js/network_config.js"></script>

<!-- <script type="text/javascript">
  (function () {
    var time = new Date().getTime()
    var e = document.getElementsByTagName("script")[0];
    var d = document.createElement("script");
    d.src = "/plugins/server/idcsmart_cloud/template/admin/js/cloud_config.js?_t=" + time + "";
    e.parentNode.insertBefore(d, e);
  })();
</script> -->