<link rel="stylesheet" href="/plugins/server/idcsmart_cloud_disk/template/admin/css/disk_config.css">
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<div class="disk-config" v-cloak>
  <div class="t-card">
    <div class="box">
      <div class="disk-box">
        <p class="com-tit"><span>{{ lang.disk_list }}</span></p>
        <!-- 磁盘列表 -->
        <div class="com-create">
          <p @click="addDisk">{{lang.create}}</p>
        </div>
        <div class="com-top">
          <span>{{lang.disk_list}}</span>
          <i></i>
        </div>
        <t-table row-key="id" :data="diskList" size="medium" :columns="diskColumns" :hover="hover"
          :loading="diskLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
          :hide-sort-tips="true" bordered>
          <template slot="sortIcon">
            <t-icon name="caret-down-small"></t-icon>
          </template>
          <template #area="{row}">
            {{row.country+row.city+row.area}}
          </template>
          <template #range="{row}">
            <span>{{row.size_min}}~{{row.size_max}}</span>
          </template>
          <template #price="{row}">
            <span>{{currency_prefix+row.price}}</span>
          </template>
          <template #op="{row}">
            <div class="com-opt">
              <t-icon name="edit-1" @click="editDisk(row)"></t-icon>
              <t-icon name="delete" @click="comDel('bw',row)"></t-icon>
            </div>
          </template>
        </t-table>
      </div>
      <!-- 周期 -->
      <div class="duration-box">
        <p class="com-tit"><span>{{ lang.cycle }}</span></p>
        <t-table row-key="id" :data="durationList" size="medium" :columns="durationColumns" :hover="hover"
          :loading="durationLoading" :table-layout="tableLayout ? 'auto' : 'fixed'" display-type="fixed-width"
          :hide-sort-tips="true" bordered>
          <template slot="sortIcon">
            <t-icon name="caret-down-small"></t-icon>
          </template>
          <template #disk_ratio="{row}">
            <t-input v-model="row.disk_ratio" v-if="row.status" autofocus></t-input>
            <span v-else>{{row.disk_ratio}}</span>
          </template>
          <template #op="{row}">
            <div class="com-opt">
              <t-icon name="edit-1" @click="editDuration(row)" v-if="!row.status"></t-icon>
              <t-icon name="save" @click="saveDuration(row)" v-else></t-icon>
            </div>
          </template>
        </t-table>
      </div>
    </div>
  </div>
  <!-- 新增/修改磁盘弹窗 -->
  <t-dialog :header="dataTitle" :visible.sync="diskModel" :footer="false" width="635" @close="closeDisk">
    <t-form :data="diskForm" ref="diskForm" @submit="submitDisk" :rules="diskRules" class="disk-form" v-if="diskModel">
      <t-form-item :label="lang.sort+'ID'" name="order">
        <t-input v-model="diskForm.order" :placeholder="lang.input + lang.sort+'ID'"></t-input>
      </t-form-item>
      <t-form-item :label="lang.show_name" name="name">
        <t-input v-model="diskForm.name" :placeholder="lang.input + lang.show_name"></t-input>
      </t-form-item>
      <t-form-item :label="lang.description" name="description">
        <t-textarea v-model="diskForm.description" :placeholder="lang.input+lang.description">
        </t-textarea>
      </t-form-item>
      <t-form-item :label="lang.available_area" name="module_idcsmart_cloud_data_center_id">
        <t-select v-model="diskForm.module_idcsmart_cloud_data_center_id"
          :placeholder="lang.select+lang.available_area">
          <t-option v-for="item in dataList" :value="item.id" :label="item.country + item.city + item.area"
            :key="item.id">
          </t-option>
        </t-select>
      </t-form-item>
      <t-form-item :label="lang.capacity_range" class="req-item">
        <div class="range">
          <t-form-item name="size_min" :required-mark="false" :rules="[
                      { validator: checkSize},
                      { required: true, message: lang.input + lang.size_min, type: 'error' },
                      {
                        pattern: /^\d+$/, message: lang.input + lang.verify16, type: 'warning'
                      }
                      ]">
            <t-input v-model="diskForm.size_min" :placeholder="lang.input + lang.size_min" @change="changeSize">
            </t-input>
          </t-form-item>
          <span class="to">{{lang.to}}</span>
          <t-form-item name="size_max" :required-mark="false" :rules="[
                      { validator: checkSize1},
                      { required: true, message: lang.input + lang.size_max, type: 'error' },
                      {
                        pattern: /^\d+$/, message: lang.input + lang.verify16, type: 'warning'
                      }
                      ]">
            <t-input v-model="diskForm.size_max" :placeholder="lang.input + lang.size_max" @change="changeSize">
            </t-input>
          </t-form-item>
          <span class="unit">GB</span>
        </div>
      </t-form-item>
      <t-form-item :label="lang.min_precision" name="precision">
        <t-input v-model="diskForm.precision" :placeholder="lang.input+lang.min_precision"></t-input>
      </t-form-item>
      <t-form-item :label="lang.unit_price" name="price">
        <t-input v-model="diskForm.price" :placeholder="lang.input+lang.unit_price" :label="currency_prefix">
        </t-input>
      </t-form-item>

      <div class="com-f-btn">
        <t-button theme="primary" type="submit">{{lang.hold}}
        </t-button>
        <t-button theme="default" variant="base" @click="closeDisk">{{lang.cancel}}</t-button>
      </div>
    </t-form>
  </t-dialog>
  <!-- 删除提示框 -->
  <t-dialog theme="warning" :header="lang.sureDelete" :close-btn="false" :visible.sync="delVisible">
    <template slot="footer">
      <t-button theme="primary" @click="sureDelete">{{lang.sure}}</t-button>
      <t-button theme="default" @click="delVisible=false">{{lang.cancel}}</t-button>
    </template>
  </t-dialog>
</div>

<script src="/plugins/server/idcsmart_cloud_disk/template/admin/api/disk_config.js"></script>

<script src="/plugins/server/idcsmart_cloud_disk/template/admin/js/disk_config.js"></script>

<!-- <script type="text/javascript">
  (function () {
    var time = new Date().getTime()
    var e = document.getElementsByTagName("script")[0];
    var d = document.createElement("script");
    d.src = "/plugins/server/idcsmart_cloud/template/admin/js/cloud_config.js?_t=" + time + "";
    e.parentNode.insertBefore(d, e);
  })();
</script> -->